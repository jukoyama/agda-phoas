module Lemma_CPS_Prev2 where

open import DStermK2
open import CPSterm2
open import CPSIsm2
open import Lemma_CPS_Subst2

open import Function
open import Relation.Binary.PropositionalEquality

correctRootğ‘ : {var : cpstyp â†’ Set} â†’ {Ï„â‚ Ï„â‚‚ Ï„â‚ƒ : typğ‘˜} â†’
               {e  : rootğ‘˜[ var âˆ˜ cpsTğ‘˜ ] Ï„â‚ cps[ Ï„â‚‚ , Ï„â‚ƒ ]} â†’
               {eâ€² : rootğ‘˜[ var âˆ˜ cpsTğ‘˜ ] Ï„â‚ cps[ Ï„â‚‚ , Ï„â‚ƒ ]} â†’
               ReduceRootğ‘˜ e eâ€² â†’
               cpsReduceR {var} (Î» k â†’ cpsMainğ‘˜ Ï„â‚ Ï„â‚‚ Ï„â‚ƒ e k)
                                (Î» k â†’ cpsMainğ‘˜ Ï„â‚ Ï„â‚‚ Ï„â‚ƒ eâ€² k)
correctRootğ‘ {var} {Ï„â‚} {Ï„â‚‚} {Ï„â‚ƒ}
             {.(Root {_} {Ï„â‚} {Ï„â‚‚} {Ï„â‚ƒ}
               (Î» k â†’ NonVal {_} {Ï„â‚„} {Ï„â‚‚} {Ï„â‚ƒ} {Ï„â‚‚} Kğ‘
                    (App {_} {Ï„â‚„} {Ï„â‚…} {Ï„â‚‚} {Ï„â‚ƒ} (Fun Ï„â‚„ Ï„â‚… {Ï„â‚‚} {Ï„â‚ƒ}
                    (Î» x â†’ Root {_} {Ï„â‚„} {Ï„â‚‚} {Ï„â‚ƒ} (e x))) v)))}
             {.(Root {_} {Ï„â‚} {Ï„â‚‚} {Ï„â‚ƒ} (Î» k â†’ eâ€²))}
             (Î²Val {Ï„ = .Ï„â‚} {Ï„â‚ = Ï„â‚„} {Ï„â‚‚ = Ï„â‚…} {Ï„â‚ƒ = .Ï„â‚‚} {Ï„â‚„ = .Ï„â‚ƒ}
                      {Kğ‘ = Kğ‘} {e = e} {v = v} {eâ€² = eâ€²} sub) =
  Î²Valğ‘ (SubstVKğ‘ sub)               
                   
correctTermğ‘ : {var : cpstyp â†’ Set} â†’ {Ï„â‚ Ï„â‚‚ Ï„â‚ƒ : typğ‘˜} â†’
               {e  : termğ‘˜[ var âˆ˜ cpsTğ‘˜ ] Ï„â‚‚ cps[ Ï„â‚‚ , Ï„â‚ƒ ]} â†’
               {eâ€² : termğ‘˜[ var âˆ˜ cpsTğ‘˜ ] Ï„â‚‚ cps[ Ï„â‚‚ , Ï„â‚ƒ ]} â†’
               ReduceTermğ‘˜ e eâ€² â†’
               cpsReduce {var} (cpsEğ‘˜ Ï„â‚ƒ Ï„â‚‚ e)
                               (cpsEğ‘˜ Ï„â‚ƒ Ï„â‚‚ eâ€²)
correctTermğ‘ {var} {Ï„â‚} {Ï„â‚‚} {Ï„â‚ƒ}
             {.(Val {_} {Ï„â‚„} {Ï„â‚ƒ} {Ï„â‚‚} (KLet {_} {Ï„â‚„} {Ï„â‚‚} {Ï„â‚ƒ} {Ï„â‚ƒ} eâ‚‚) v)} {eâ€²}
             (Î²Let {Ï„â‚ = Ï„â‚„} {Ï„â‚‚ = .Ï„â‚‚} {Î² = .Ï„â‚ƒ} {eâ‚‚ = eâ‚‚} {v = v} {eâ‚‚â€² = .eâ€²} sub) =
  Î²Letğ‘ (SubstVğ‘ sub)

correctTermğ‘ğ‘  : {var : cpstyp â†’ Set} â†’ {Ï„â‚ Ï„â‚‚ Ï„â‚ƒ : typğ‘˜} â†’
                {e  : termğ‘˜[ var âˆ˜ cpsTğ‘˜ ] Ï„â‚‚ cps[ Ï„â‚‚ , Ï„â‚ƒ ]} â†’
                {eâ€² : termğ‘˜[ var âˆ˜ cpsTğ‘˜ ] Ï„â‚‚ cps[ Ï„â‚‚ , Ï„â‚ƒ ]} â†’
                ReduceTermğ‘˜ğ‘  (NonVal Hole (Reset Ï„â‚‚ Ï„â‚ƒ Ï„â‚ƒ e))
                             (NonVal Hole (Reset Ï„â‚‚ Ï„â‚ƒ Ï„â‚ƒ eâ€²)) â†’
                cpsReduceâ€¢ {var} (cpsEğ‘˜ Ï„â‚ƒ Ï„â‚‚ e)
                                 (cpsEğ‘˜ Ï„â‚ƒ Ï„â‚‚ eâ€²)
correctTermğ‘ğ‘  {var} {Ï„â‚} {Ï„â‚‚} {Ï„â‚ƒ}
              {.(NonVal {_} {Ï„â‚…} {Ï„â‚ƒ} {Ï„â‚ƒ} {Ï„â‚‚} Kğ‘
                (App {_} {Ï„â‚…} {(Ï„â‚… â‡’ Ï„â‚ƒ cps[ Ï„ , Ï„ ]) â‡’ Ï„â‚‚ cps[ Ï„â‚‚ , Ï„â‚ƒ ]} {Ï„â‚ƒ} {Ï„â‚ƒ}
                     (Shift {_} {Ï„} {Ï„â‚‚} {Ï„â‚ƒ} {Ï„â‚…} {Ï„â‚ƒ}) w))}
              {.(NonVal {_} {Ï„â‚‚} {Ï„â‚‚} {Ï„â‚ƒ} {Ï„â‚‚} (Hole {_} {Ï„â‚‚} {Ï„â‚ƒ})
                (App {_} {Ï„â‚‚} {Ï„â‚… â‡’ Ï„â‚ƒ cps[ Ï„ , Ï„ ]} {Ï„â‚‚} {Ï„â‚ƒ}
                     w
                     (Fun Ï„â‚ƒ Ï„â‚… {Ï„} {Ï„} (Î» y â†’ Root {_} {Ï„â‚ƒ} {Ï„} {Ï„}
                          (Î» k â†’ NonVal {_} {Ï„â‚ƒ} {Ï„} {Ï„} {Ï„} (KHole {_} {Ï„â‚ƒ} {Ï„} {Ï„} k)
                                 (Reset Ï„â‚‚ Ï„â‚ƒ Ï„ (Val {_} {Ï„â‚…} {Ï„â‚ƒ} {Ï„â‚‚} Kğ‘ (Var {_} {Ï„â‚…} y))))))))}
              (Î²Shift {Ï„ = Ï„} {Ï„â‚ = .Ï„â‚‚} {Ï„â‚‚ = Ï„â‚„} {Ï„â‚ƒ = Ï„â‚…} {Ï„â‚„ = .Ï„â‚ƒ} {Ï„â‚… = .Ï„â‚‚}
                      {Kğ‘ = Kğ‘} {w = w}) =
  Î²Shiftğ‘
  
correctValğ‘ : {var : cpstyp â†’ Set} â†’ {Ï„â‚ : typğ‘˜} â†’
              {v  : valueğ‘˜[ var âˆ˜ cpsTğ‘˜ ] Ï„â‚ cps[Ï„,Ï„]} â†’ 
              {vâ€² : valueğ‘˜[ var âˆ˜ cpsTğ‘˜ ] Ï„â‚ cps[Ï„,Ï„]} â†’
              ReduceValğ‘˜ v vâ€² â†’
              cpsReduceV {var} (cpsVğ‘˜ Ï„â‚ v) (cpsVğ‘˜ Ï„â‚ vâ€²)
correctValğ‘ {var} {.(Ï„â‚‚ â‡’ Ï„â‚ cps[ Ï„â‚ƒ , Ï„â‚„ ])}
            {.(Fun Ï„â‚ Ï„â‚‚ {Ï„â‚ƒ} {Ï„â‚„} (Î» x â†’ Root {_} {Ï„â‚} {Ï„â‚ƒ} {Ï„â‚„} (Î» k â†’
              NonVal {_} {Ï„â‚} {Ï„â‚ƒ} {Ï„â‚„} {Ï„â‚ƒ}
                     (KHole {_} {Ï„â‚} {Ï„â‚ƒ} {Ï„â‚„} k)
                     (App {_} {Ï„â‚} {Ï„â‚‚} {Ï„â‚ƒ} {Ï„â‚„} vâ€² (Var {_} {Ï„â‚‚} x)))))}
            {vâ€²}
            (Î·Val {Ï„â‚ = Ï„â‚} {Ï„â‚‚ = Ï„â‚‚} {Ï„â‚ƒ = Ï„â‚ƒ} {Ï„â‚„ = Ï„â‚„} {v = .vâ€²}) =
  Î·Valğ‘

correctConğ‘ : {var : cpstyp â†’ Set} â†’ {Ï„â‚ Ï„â‚‚ Ï„â‚ƒ Ï„â‚‡ Ï„â‚ˆ : typğ‘˜} â†’
              {p  : pcontextğ‘˜[ var âˆ˜ cpsTğ‘˜ , Ï„â‚ cps[ Ï„â‚‚ , Ï„â‚ƒ ]] Ï„â‚‡
                            cps[ Ï„â‚‡ , Ï„â‚ƒ ]} â†’
              {pâ€² : pcontextğ‘˜[ var âˆ˜ cpsTğ‘˜ , Ï„â‚ cps[ Ï„â‚‚ , Ï„â‚ƒ ]] Ï„â‚‡
                            cps[ Ï„â‚‡ , Ï„â‚ƒ ]} â†’
              ReduceConğ‘˜ p pâ€² â†’
              cpsReduceK {var} (cpsCğ‘˜ Ï„â‚ Ï„â‚‚ Ï„â‚ƒ Ï„â‚‡ p)
                               (cpsCğ‘˜ Ï„â‚ Ï„â‚‚ Ï„â‚ƒ Ï„â‚‡ pâ€²)
correctConğ‘ {var} {Ï„â‚} {Ï„â‚‚} {.Ï„â‚‚} {Ï„â‚‡} {Ï„â‚ˆ}
            {.(KLet {_} {Ï„â‚} {Ï„â‚‡} {Ï„â‚‚} {Ï„â‚‚}
              (Î» x â†’ Val {_} {Ï„â‚} {Ï„â‚‚} {Ï„â‚‡} pâ€² (Var {_} {Ï„â‚} x)))} {pâ€²}
            (Î·Let {Ï„â‚ = .Ï„â‚} {Ï„â‚‚ = .Ï„â‚‡} {Î² = .Ï„â‚‚} {Kğ‘ = .pâ€²}) =
  Î·Letğ‘
